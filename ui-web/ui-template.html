<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AutoBuy Dashboard</title>
<link rel="stylesheet" href="ui-style.css">
</head>
<body>

<div class="hdr">
  <h1>âš¡ AutoBuy <span class="tc-muted" id="site-count"></span></h1>
  <div class="hdr-right">
    <span id="elapsed">00:00</span>
    <span id="ws-status">ğŸŸ¢ Live</span>
    <button id="theme-toggle" onclick="toggleTheme()" title="Äá»•i giao diá»‡n">ğŸŒ™</button>
    <button class="btn-g" onclick="sendCmd('startAll')">â–¶ Start All</button>
    <button class="btn-r" onclick="confirmStopAll()">â–  Stop All</button>
  </div>
</div>

<nav>
  <button class="nb active" onclick="showPage('dashboard',this)">ğŸ“Š Dashboard</button>
  <button class="nb"        onclick="showPage('history',this)">ğŸ“‹ Lá»‹ch sá»­</button>
  <button class="nb"        onclick="showPage('settings',this)">âš™ï¸ Cáº¥u hÃ¬nh</button>
  <button class="nb"        onclick="showPage('notifier',this)">ğŸ”” ThÃ´ng bÃ¡o</button>
  <button class="nb"        onclick="showPage('scheduler',this)">â° Háº¹n giá»</button>
  <button class="nb"        onclick="showPage('sites',this)">ğŸŒ Sites</button>
  <button class="nb"        onclick="showPage('analytics',this)">ğŸ“ˆ Analytics</button>
  <button class="nb"        onclick="showPage('health',this)">ğŸ’š Health</button>
</nav>

<!-- â•â• DASHBOARD â•â• -->
<div id="page-dashboard" class="page active">
  <div class="stats-row">
    <div class="stat g"><div class="stat-l">Tá»•ng Ä‘Ã£ mua</div><div class="stat-v gc" id="s-bought">0</div></div>
    <div class="stat y"><div class="stat-l">Tá»•ng chi</div><div class="stat-v yc" id="s-spent">0â‚«</div></div>
    <div class="stat">  <div class="stat-l">Accounts Ä‘ang cháº¡y</div><div class="stat-v ac" id="s-running">0</div></div>
    <div class="stat">  <div class="stat-l">Sites hoáº¡t Ä‘á»™ng</div><div class="stat-v" id="s-sites">0</div></div>
  </div>

  <div class="accounts-grid" id="accounts-grid">
    <div class="no-data-msg">Äang khá»Ÿi Ä‘á»™ng...</div>
  </div>

  <div class="bottom">
    <div class="card">
      <div class="card-head">
        <span>ğŸ“‹ Log realtime</span>
        <div style="display:flex;gap:6px">
          <select id="log-filter" class="log-filter-select" onchange="renderLog()">
            <option value="">Táº¥t cáº£</option>
          </select>
          <button class="btn-ghost btn-xs" onclick="document.getElementById('log-box').innerHTML=''">xÃ³a</button>
        </div>
      </div>
      <div id="log-box"></div>
    </div>
    <div class="card">
      <div class="card-head">
        <span>ğŸ‰ Acc Ä‘Ã£ mua (<span id="bought-count">0</span>)</span>
        <button class="btn-ghost btn-xs" onclick="clearBought()">xÃ³a</button>
      </div>
      <div id="bought-box"><div class="no-data">ChÆ°a cÃ³ acc nÃ o...</div></div>
    </div>
  </div>
</div>

<!-- â•â• HISTORY â•â• -->
<div id="page-history" class="page">
  <div class="history-toolbar">
    <select id="h-site" onchange="resetHistoryPage()"><option value="">Táº¥t cáº£ site</option></select>
    <select id="h-acc"  onchange="resetHistoryPage()"><option value="">Táº¥t cáº£ account</option></select>
    <input type="date" id="h-from" onchange="resetHistoryPage()">
    <input type="date" id="h-to"   onchange="resetHistoryPage()">
    <button class="btn-p" onclick="exportCSVFiltered()">â¬‡ Export CSV</button>
    <button class="btn-d" onclick="if(confirm('XÃ³a toÃ n bá»™ lá»‹ch sá»­?'))sendCmd('clearHistory')">ğŸ—‘ XÃ³a táº¥t cáº£</button>
  </div>
  <div class="card">
    <div id="history-table-wrap">
      <table>
        <thead><tr><th>Thá»i gian</th><th>Site</th><th>Account</th><th>Acc ID</th><th>GiÃ¡</th><th></th></tr></thead>
        <tbody id="history-body"></tbody>
      </table>
    </div>
    <div id="load-more-wrap"></div>
  </div>
</div>

<!-- â•â• SETTINGS â•â• -->
<div id="page-settings" class="page">
  <div id="site-sel-wrap" class="site-sel-wrap">
    <span class="hint">Chá»n site:</span>
    <select id="site-sel" onchange="loadSettings()"></select>
  </div>

  <div id="err-banner" class="err-banner"></div>

  <div class="settings-grid">
    <div style="display:flex;flex-direction:column;gap:14px">
      <div class="sec">
        <h3>ğŸ” Site & URL</h3>
        <div class="field">
          <label>URL trang sáº£n pháº©m</label>
          <input type="text" id="cfg-url">
          <div class="hint">URL chá»©a cate_id (vÃ­ dá»¥: /accounts/xxxx-xxxx)</div>
        </div>
      </div>

      <div class="sec">
        <h3>ğŸ‘¥ TÃ i khoáº£n</h3>
        <table class="acc-table">
          <thead><tr><th>Username</th><th>Password</th><th>Label</th><th style="text-align:center">Báº­t</th><th></th></tr></thead>
          <tbody id="acc-tbody">
            <tr><td colspan="5" class="no-data">Äang táº£i...</td></tr>
          </tbody>
        </table>
        <div class="acc-add-row">
          <input type="text"     id="new-username" placeholder="username">
          <input type="password" id="new-password" placeholder="password">
          <input type="text"     id="new-label"    placeholder="label (tuá»³ chá»n)">
          <button class="btn-g" onclick="addNewAcc()" style="white-space:nowrap">+ ThÃªm</button>
        </div>
        <div class="hint" style="margin-top:6px">âš  Thay Ä‘á»•i accounts cáº§n restart script má»›i cÃ³ hiá»‡u lá»±c.</div>
      </div>

      <div class="sec">
        <h3>ğŸ’° GiÃ¡ & Giá»›i háº¡n</h3>
        <div class="field"><label>GiÃ¡ tá»‘i Ä‘a (â‚«)</label><input type="number" id="cfg-maxPrice" min="0"></div>
        <div class="field"><label>Sá»‘ acc tá»‘i Ä‘a (0 = khÃ´ng giá»›i háº¡n)</label><input type="number" id="cfg-maxBuy" min="0"></div>
        <div class="field"><label>Sá»‘ acc láº¥y má»—i láº§n</label><input type="number" id="cfg-fetchLimit" min="1"></div>
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:14px">
      <div class="sec">
        <h3>â± Timing</h3>
        <div class="field"><label>Delay bÃ¬nh thÆ°á»ng (ms)</label><input type="number" id="cfg-retryNormal" min="50"></div>
        <div class="field"><label>Delay khi sale (ms)</label><input type="number" id="cfg-retrySale" min="10"></div>
        <div class="field"><label>Jitter (ms)</label><input type="number" id="cfg-jitter" min="0"></div>
        <div class="field"><label>Cooldown sau 429 (ms)</label><input type="number" id="cfg-cooldown" min="1000"></div>
        <div class="field">
          <label>Empty threshold (sá»‘ láº§n trá»‘ng liÃªn tiáº¿p Ä‘á»ƒ giáº£m tá»‘c)</label>
          <input type="number" id="cfg-emptyThreshold" min="1">
        </div>
        <div class="field">
          <label>Page timeout â€“ Puppeteer login (ms)</label>
          <input type="number" id="cfg-pageTimeout" min="3000">
          <div class="hint">âš  Thay Ä‘á»•i cáº§n restart script má»›i cÃ³ hiá»‡u lá»±c.</div>
        </div>
      </div>

      <div class="sec">
        <h3>ğŸŒ Web UI</h3>
        <div class="toggle-row">
          <span class="toggle-label">Terminal UI</span>
          <label class="toggle"><input type="checkbox" id="cfg-terminal"><span class="tslider"></span></label>
        </div>
        <div class="toggle-row">
          <span class="toggle-label">Remote access</span>
          <label class="toggle"><input type="checkbox" id="cfg-remote"><span class="tslider"></span></label>
        </div>
        <div class="field"><label>Port</label><input type="number" id="cfg-port" min="1024" max="65535"></div>
        <div class="warn-box">âš  Thay Ä‘á»•i Remote / Port cáº§n restart script má»›i cÃ³ hiá»‡u lá»±c.</div>
      </div>

      <!-- Gá»™p Auth vÃ o Settings -->
      <div class="sec">
        <h3>ğŸ”’ XÃ¡c thá»±c Web UI</h3>
        <p class="hint" style="margin-bottom:12px">Chá»‰ Ã¡p dá»¥ng khi <code>remote: true</code>. Localhost khÃ´ng cáº§n auth.</p>
        <div class="toggle-row" style="margin-bottom:14px">
          <span class="toggle-label fw-bold">Báº­t xÃ¡c thá»±c</span>
          <label class="toggle"><input type="checkbox" id="auth-enabled"><span class="tslider"></span></label>
        </div>
        <div class="field">
          <label>TÃªn Ä‘Äƒng nháº­p</label>
          <input type="text" id="auth-username" value="admin" autocomplete="off">
        </div>
        <div class="field">
          <label>Máº­t kháº©u má»›i</label>
          <input type="password" id="auth-password" placeholder="Äá»ƒ trá»‘ng = khÃ´ng Ä‘á»•i máº­t kháº©u" autocomplete="new-password">
        </div>
        <div class="hint" style="margin-top:4px">Config lÆ°u táº¡i <code>auth.json</code>. Cáº§n restart Ä‘á»ƒ Ã¡p dá»¥ng vá»›i WebSocket.</div>
        <div style="display:flex;justify-content:flex-end;margin-top:12px">
          <button class="btn-p" onclick="saveAuthConfig()">ğŸ’¾ LÆ°u auth</button>
          <span class="saved" id="auth-saved-msg" style="margin-left:10px;align-self:center">âœ“ ÄÃ£ lÆ°u</span>
        </div>
      </div>
    </div>
  </div>

  <div class="sf">
    <span class="saved" id="saved-msg">âœ“ ÄÃ£ lÆ°u</span>
    <button class="btn-d" onclick="resetSettings()">â†º Reset vá» máº·c Ä‘á»‹nh</button>
    <button class="btn-p" onclick="saveSettings()">ğŸ’¾ LÆ°u</button>
  </div>
</div>

<!-- â•â• NOTIFIER (gá»™p Telegram + Desktop + Webhook) â•â• -->
<div id="page-notifier" class="page">
  <!-- Sub-tabs -->
  <div class="subtabs">
    <button class="stab active" onclick="showSubtab('ntf','telegram',this)">ğŸ“± Telegram</button>
    <button class="stab"        onclick="showSubtab('ntf','webhook',this)">ğŸ”— Webhook</button>
    <button class="stab"        onclick="showSubtab('ntf','desktop',this)">ğŸ–¥ Desktop</button>
  </div>

  <!-- Telegram -->
  <div id="ntf-telegram" class="subtab-page active">
    <div class="settings-grid">
      <div class="sec">
        <h3>ğŸ“± Telegram Bot</h3>
        <div class="notif-group">
          <div class="toggle-row">
            <span class="toggle-label fw-bold">Báº­t Telegram</span>
            <label class="toggle"><input type="checkbox" id="ntf-tg-enabled"><span class="tslider"></span></label>
          </div>
          <div class="field"><label>Bot Token</label><input type="text" id="ntf-tg-token" placeholder="123456:ABC-DEF..."></div>
          <div class="field">
            <label>Chat ID</label>
            <input type="text" id="ntf-tg-chatid" placeholder="-100123456789">
            <div class="hint">DÃ¹ng @userinfobot Ä‘á»ƒ láº¥y chat ID</div>
          </div>
        </div>
        <div class="notif-group">
          <div class="notif-group-title">Nháº­n thÃ´ng bÃ¡o khi:</div>
          <div class="toggle-row"><span class="toggle-label">ğŸ‰ Mua Ä‘Æ°á»£c acc</span>     <label class="toggle"><input type="checkbox" id="ntf-tg-bought"><span class="tslider"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">ğŸ’¸ Háº¿t tiá»n</span>         <label class="toggle"><input type="checkbox" id="ntf-tg-money"><span class="tslider"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">âš ï¸ Engine lá»—i/restart</span><label class="toggle"><input type="checkbox" id="ntf-tg-error"><span class="tslider"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">ğŸš€ Start All</span>        <label class="toggle"><input type="checkbox" id="ntf-tg-start"><span class="tslider"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">ğŸ›‘ Stop All</span>         <label class="toggle"><input type="checkbox" id="ntf-tg-stop"><span class="tslider"></span></label></div>
        </div>
      </div>
      <div class="sec">
        <h3>ğŸ§ª Test</h3>
        <p class="hint" style="margin-bottom:12px">Gá»­i thÃ´ng bÃ¡o thá»­ Ä‘á»ƒ kiá»ƒm tra cáº¥u hÃ¬nh.</p>
        <button class="btn-ghost" onclick="testNotifier()" style="width:100%">ğŸ“¤ Gá»­i test ngay</button>
      </div>
    </div>
  </div>

  <!-- Webhook -->
  <div id="ntf-webhook" class="subtab-page">
    <div class="settings-grid">
      <div class="sec">
        <h3>ğŸ”— Webhook Outbound</h3>
        <p class="hint" style="margin-bottom:12px">Gá»­i POST JSON Ä‘áº¿n báº¥t ká»³ URL nÃ o â€” Discord, Slack, hoáº·c endpoint riÃªng.</p>
        <div class="toggle-row" style="margin-bottom:14px">
          <span class="toggle-label fw-bold">Báº­t Webhook</span>
          <label class="toggle"><input type="checkbox" id="wh-enabled"><span class="tslider"></span></label>
        </div>
        <div class="field"><label>Webhook URL</label><input type="text" id="wh-url" placeholder="https://discord.com/api/webhooks/..."></div>
        <div class="field">
          <label>Format</label>
          <select id="wh-format" class="sel">
            <option value="generic">Generic JSON</option>
            <option value="discord">Discord Embeds</option>
          </select>
        </div>
        <div class="notif-group" style="margin-top:14px;padding-top:14px;border-top:1px solid var(--b)">
          <div class="notif-group-title">Gá»­i khi:</div>
          <div class="toggle-row"><span class="toggle-label">ğŸ‰ Mua Ä‘Æ°á»£c</span>   <label class="toggle"><input type="checkbox" id="wh-ev-bought"><span class="tslider"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">âš ï¸ Lá»—i/Restart</span><label class="toggle"><input type="checkbox" id="wh-ev-error"><span class="tslider"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">ğŸš€ Start All</span>  <label class="toggle"><input type="checkbox" id="wh-ev-start"><span class="tslider"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">ğŸ›‘ Stop All</span>   <label class="toggle"><input type="checkbox" id="wh-ev-stop"><span class="tslider"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">ğŸ’¸ Háº¿t tiá»n</span>   <label class="toggle"><input type="checkbox" id="wh-ev-money"><span class="tslider"></span></label></div>
        </div>
      </div>
      <div class="sec">
        <h3>ğŸ§ª Test</h3>
        <p class="hint" style="margin-bottom:12px">LÆ°u config trÆ°á»›c rá»“i gá»­i test.</p>
        <button class="btn-ghost" onclick="testWebhook()" style="width:100%">ğŸ“¤ Gá»­i test ngay</button>
        <div class="sec" style="margin-top:14px">
          <h3>â„¹ï¸ HÆ°á»›ng dáº«n</h3>
          <div class="guide-list">
            <div>â€¢ <strong>Discord:</strong> Server Settings â†’ Integrations â†’ Webhooks</div>
            <div>â€¢ <strong>Slack:</strong> DÃ¹ng Incoming Webhooks app</div>
            <div>â€¢ <strong>Generic:</strong> Nháº­n <code>{ event, data, ts }</code></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Desktop -->
  <div id="ntf-desktop" class="subtab-page">
    <div class="sec" style="max-width:480px">
      <h3>ğŸ–¥ Desktop Notification</h3>
      <div class="toggle-row" style="margin-bottom:14px">
        <span class="toggle-label fw-bold">Báº­t Desktop</span>
        <label class="toggle"><input type="checkbox" id="ntf-desktop-enabled"><span class="tslider"></span></label>
      </div>
      <div class="hint">YÃªu cáº§u cÃ i: <code>npm install node-notifier</code></div>
    </div>
  </div>

  <div class="sf">
    <span class="saved" id="notif-saved-msg">âœ“ ÄÃ£ lÆ°u</span>
    <button class="btn-p" onclick="saveNotifierConfig()">ğŸ’¾ LÆ°u</button>
    <span class="saved" id="wh-saved-msg" style="display:none">âœ“ ÄÃ£ lÆ°u webhook</span>
    <button class="btn-p" id="wh-save-btn" onclick="saveWebhookConfig()" style="display:none">ğŸ’¾ LÆ°u webhook</button>
  </div>
</div>

<!-- â•â• SCHEDULER (gá»™p Single + Multi) â•â• -->
<div id="page-scheduler" class="page">
  <div class="subtabs">
    <button class="stab active" onclick="showSubtab('sched','single',this)">â° Má»™t láº§n</button>
    <button class="stab"        onclick="showSubtab('sched','multi',this)">ğŸ“… Theo site</button>
  </div>

  <!-- Single scheduler -->
  <div id="sched-single" class="subtab-page active">
    <div id="sched-status-box" style="display:none">
      <div class="countdown-box">
        <div class="countdown-label">Sáº½ tá»± Ä‘á»™ng Start All sau</div>
        <span class="countdown-time" id="sched-countdown">00:00:00</span>
        <div class="countdown-target" id="sched-target-label"></div>
      </div>
      <div style="text-align:center">
        <button class="btn-d" onclick="cancelSchedule()">âœ• Huá»· lá»‹ch</button>
      </div>
    </div>
    <div id="sched-form-wrap">
      <div class="settings-grid">
        <div class="sec">
          <h3>â° Äáº·t giá» báº¯t Ä‘áº§u</h3>
          <div class="field">
            <label>Giá» báº¯t Ä‘áº§u (hÃ´m nay hoáº·c ngÃ y mai)</label>
            <input type="time" id="sched-time" step="1" style="width:100%">
            <div class="hint">Náº¿u giá» Ä‘Ã£ qua sáº½ tá»± Ä‘á»™ng chuyá»ƒn sang ngÃ y mai</div>
          </div>
          <div class="field">
            <label>Pre-warm trÆ°á»›c (giÃ¢y)</label>
            <input type="number" id="sched-prewarm" value="30" min="5" max="120" class="field-input-full">
            <div class="hint">Khá»Ÿi Ä‘á»™ng session Puppeteer trÆ°á»›c N giÃ¢y</div>
          </div>
          <button class="btn-p" onclick="scheduleStart()" style="width:100%;margin-top:6px">â° Äáº·t lá»‹ch</button>
        </div>
        <div class="sec">
          <h3>â„¹ï¸ HÆ°á»›ng dáº«n</h3>
          <div class="guide-list">
            <div>1. Nháº­p giá» muá»‘n báº¯t Ä‘áº§u (VD: <code class="code-accent">12:00:00</code>)</div>
            <div>2. Äáº·t pre-warm Ä‘á»ƒ login Puppeteer trÆ°á»›c (máº·c Ä‘á»‹nh 30 giÃ¢y)</div>
            <div>3. Nháº¥n <strong class="code-accent">Äáº·t lá»‹ch</strong> â€” Ä‘á»“ng há»“ Ä‘áº¿m ngÆ°á»£c sáº½ hiá»‡n ra</div>
            <div>4. ÄÃºng giá» â†’ tool tá»± Ä‘á»™ng Start All</div>
            <div class="info-box" style="margin-top:10px">ğŸ’¡ Lá»‹ch Ä‘Æ°á»£c lÆ°u vÃ o <code>scheduler.json</code>, reload trang khÃ´ng máº¥t lá»‹ch.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Multi scheduler -->
  <div id="sched-multi" class="subtab-page">
    <div class="settings-grid">
      <div class="sec">
        <h3>ğŸ“… Äáº·t lá»‹ch theo site</h3>
        <div class="field">
          <label>Site</label>
          <select id="ms-site" class="sel"></select>
        </div>
        <div class="field">
          <label>Giá» báº¯t Ä‘áº§u</label>
          <input type="time" id="ms-time" step="1" style="width:100%">
          <div class="hint">Náº¿u Ä‘Ã£ qua sáº½ tá»± chuyá»ƒn sang ngÃ y mai</div>
        </div>
        <div class="field">
          <label>Pre-warm (giÃ¢y)</label>
          <input type="number" id="ms-prewarm" value="30" min="5" max="120" class="field-input-full">
        </div>
        <div class="field">
          <label>Label (tuá»³ chá»n)</label>
          <input type="text" id="ms-label" class="field-input-full" placeholder="VD: Flash sale 12h">
        </div>
        <button class="btn-p" onclick="addMultiSchedule()" style="width:100%;margin-top:4px">â° Äáº·t lá»‹ch</button>
      </div>
      <div class="sec">
        <h3>ğŸ“‹ Lá»‹ch Ä‘Ã£ Ä‘áº·t</h3>
        <div id="ms-list"><div class="no-data">ChÆ°a cÃ³ lá»‹ch nÃ o</div></div>
        <div style="display:flex;gap:8px;margin-top:12px;padding-top:12px;border-top:1px solid var(--b)">
          <button class="btn-ghost" onclick="sendCmd('cleanupMultiSchedule')" style="flex:1;font-size:.68rem">ğŸ§¹ Dá»n lá»‹ch cÅ©</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â• SITES â•â• -->
<div id="page-sites" class="page">
  <div class="settings-grid">
    <div class="sec">
      <h3>ğŸŒ Danh sÃ¡ch site Ä‘ang cháº¡y</h3>
      <div id="site-list-items">
        <div class="no-data" style="padding:20px">Äang táº£i...</div>
      </div>
      <div class="hint" style="margin-top:10px">XoÃ¡ site sáº½ xoÃ¡ file <code>sites/&lt;id&gt;.json</code> vÃ  khÃ´ng thá»ƒ hoÃ n tÃ¡c.</div>
    </div>
    <div class="sec">
      <h3>â• ThÃªm site má»›i</h3>
      <p class="hint" style="margin-bottom:10px">DÃ¡n JSON config site vÃ o Ä‘Ã¢y. Nháº¥n "DÃ¹ng template" Ä‘á»ƒ báº¯t Ä‘áº§u.</p>
      <textarea id="new-site-json" class="json-editor" placeholder='{ "id": "mysite", ... }'></textarea>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn-ghost" onclick="fillSiteTemplate()" style="flex:1">ğŸ“‹ DÃ¹ng template</button>
        <button class="btn-p"     onclick="validateAndAddSite()" style="flex:1">âœ“ ThÃªm site</button>
      </div>
      <div class="hint" style="margin-top:8px">File sáº½ Ä‘Æ°á»£c lÆ°u táº¡i <code>sites/&lt;id&gt;.json</code> vÃ  engine cáº§n restart Ä‘á»ƒ cháº¡y site má»›i.</div>
    </div>
  </div>
</div>

<!-- â•â• ANALYTICS â•â• -->
<div id="page-analytics" class="page">
  <div class="analytics-toolbar">
    <span class="hint">Khoáº£ng thá»i gian:</span>
    <select id="analytics-days" onchange="loadAnalytics()" class="analytics-select">
      <option value="1">24 giá» qua</option>
      <option value="3">3 ngÃ y</option>
      <option value="7" selected>7 ngÃ y</option>
      <option value="30">30 ngÃ y</option>
    </select>
    <button class="btn-ghost" onclick="loadAnalytics()" style="padding:5px 14px;font-size:.72rem">â†º Refresh</button>
  </div>
  <div id="analytics-content">
    <div class="no-data">Äang táº£i...</div>
  </div>
</div>

<!-- â•â• HEALTH (Account Health + Retry Strategy) â•â• -->
<div id="page-health" class="page">
  <div class="settings-grid" style="margin-bottom:14px">
    <div class="sec">
      <h3>ğŸ’š Account Health</h3>
      <p class="hint" style="margin-bottom:12px">Äiá»ƒm sá»©c khoáº» tá»•ng há»£p (cáº­p nháº­t má»—i 10s). Dá»±a trÃªn tá»· lá»‡ 429, restart, lá»‹ch sá»­ mua.</p>
      <div id="health-list"><div class="no-data">Äang táº£i...</div></div>
    </div>
    <div class="sec">
      <h3>ğŸ” Retry Strategy</h3>
      <p class="hint" style="margin-bottom:12px">Cáº¥u hÃ¬nh chiáº¿n lÆ°á»£c retry cho tá»«ng site.</p>
      <div class="field">
        <label>Site</label>
        <select id="retry-site" class="sel" onchange="loadRetryForSite()"></select>
      </div>
      <div class="field">
        <label>Preset</label>
        <select id="retry-preset" onchange="applyRetryPreset()" class="sel">
          <option value="">-- Chá»n preset --</option>
          <option value="aggressive">âš¡ Aggressive (1s, x1.5, max 30s)</option>
          <option value="default">âš–ï¸ Default (3s, x2, max 60s)</option>
          <option value="patient">ğŸ¢ Patient (5s linear, max 60s)</option>
          <option value="stepped">ğŸ“¶ Stepped (2â†’5â†’10â†’20â†’60s)</option>
        </select>
      </div>
      <div class="field">
        <label>Type</label>
        <select id="retry-type" class="sel">
          <option value="exponential">Exponential</option>
          <option value="linear">Linear</option>
          <option value="stepped">Stepped</option>
        </select>
      </div>
      <div class="field"><label>Base delay (ms)</label><input type="number" id="retry-base" value="3000" min="100" class="field-input-full"></div>
      <div class="field"><label>Max delay (ms)</label><input type="number" id="retry-max" value="60000" min="1000" class="field-input-full"></div>
      <div class="field"><label>Max retries</label><input type="number" id="retry-count" value="10" min="1" max="50" class="field-input-full"></div>
      <div class="field"><label>Jitter (ms, 0 = táº¯t)</label><input type="number" id="retry-jitter" value="0" min="0" class="field-input-full"></div>
      <button class="btn-p" onclick="saveRetryStrategy()" style="width:100%;margin-top:4px">ğŸ’¾ LÆ°u retry strategy</button>
      <span class="saved" id="retry-saved-msg" style="display:block;margin-top:8px;text-align:center">âœ“ ÄÃ£ lÆ°u</span>
    </div>
  </div>
  <div class="sec">
    <h3>ğŸ“Š Session Health Monitor</h3>
    <p class="hint" style="margin-bottom:10px">Tráº¡ng thÃ¡i session theo thá»i gian thá»±c. Xanh = healthy, Ä‘á» = expired/lá»—i.</p>
    <div id="session-health-list"><div class="no-data">Äang chá» dá»¯ liá»‡u...</div></div>
  </div>
</div>

<!-- Export buttons injected into history toolbar -->
<template id="tpl-export-extra">
  <button class="btn-ghost" onclick="sendCmd('exportJSON',{filter:getHistoryFilter()})">â¬‡ JSON</button>
  <button class="btn-ghost" onclick="sendCmd('exportSummary')">ğŸ“Š Summary</button>
</template>

<script src="ui-client.js"></script>
</body>
</html>
